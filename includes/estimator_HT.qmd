Let $\mathcal{K} =  \{1,2,...,N\} $ be a finite population. 
For each $i\in\mathcal{K}$, let $Y_i$ be an observable of unit $i$.
Our goal is to estimate
$$
Y = \sum_{i=1}^N Y_i
$$
the total of interest. And
$$
\tau = \frac{1}{N}  \sum_{i=1}^N Y_i
$$
the average of the population.

To construct the estimator we take a random sample of $n< N$ units from $\mathcal{K}$.
Any sampling method is allowed, but the obtained sample must have distinct units.
Let $\pi_i$ be the probability the $i^{th}$ unit is included in the sample (assume $\pi_i > 0$).
Denote the random sample by $\bf{S} = \{i_1,...,i_n\} \subset \mathcal{S}$.
The Horvitz Thompson esimator is 
$$
\hat Y_{HT} = \sum_{i\in \bf{S}} \frac{Y_i}{\pi_i} = \sum_{i=1}^N \frac{Y_i 1_{\{i\in \bf S\}}}{\pi_i}
$$
and 
$$
\hat \tau_{HT} = \frac{1}{N} \hat Y_{HT} 
$$

The estimator is unbiased
$$
    \mathbb{E}[\hat Y_{HT}] = Y.
$$
$$
    \mathbb{E}[\hat tau_{HT}] = \tau.
$$

To state the variance of $\hat Y_{HT}$, 
define $\pi_{ij}$ as the probability that both $i$ and $j$ belong to $\bf{S}$. 
The variance of Horvitz Thompson is then
$$
Var(\hat Y_{HT}) 
    = 
        \sum_{i=1}^N \sum_{j=1}^{N} \frac{\pi_{ij} - \pi_i\pi_j}{\pi_i\pi_j} Y_i Y_j
$$
(it follows from the definition that $\pi_{ii} = \pi_i $)
$$
Var(\hat \tau_{HT}) 
    = 
        \frac{1}{N^2}\sum_{i=1}^N \sum_{j=1}^{N} \frac{\pi_{ij} - \pi_i\pi_j}{\pi_i\pi_j} Y_i Y_j
$$

As we want to assure that the Horwitz Thompson estimator converges well to the quantity of interest, 
controlling the variance is key.
It is not hard to see the variance has an upper bound,
$$
Var(\hat Y_{HT}) \leq \sum_{i,j=1}^N \left(\frac{1}{\pi_i^{1/2}\pi_j^{1/2}} - 1\right) Y_i Y_j
$$
but if some of the $\pi_i$ are small this raises the small denominator problem. 
So care would have to be taken in this case. 
This danger can be mollified through a modification of the HTE, the Hajek estimator.
(Also note that as the sample becomes larger, the $\pi_i$ become larger,
better controlling the variance.)

**Example**

Consider a collection of cities with populations greater than some lower bound $b$ in some state.
Let the cities be enumerated by $\mathcal{K} =  \{1,2,..,N\}$.
Let $Y_i$ be the total number of hotels in the ith city. 

Sample as follows, select $m$ units from $\mathcal{K}$ with replacement with probability $p_i$.
Here let $p_i$ be proportional to the population of the $i^{th}$ city.
Let $\bf{S}$ be the set of distinct units from the sample. 
The inclusion probabilities are
$$
\pi_i = 1 - (1 - p_i)^m
$$
$$
\pi_{ij} = \pi_i + \pi_j - (1 - (1 - p_i - p_j)^m)
$$

The estimate of the average number of hotels in large cities would be given by $\hat Y_{HT}$ after sampling 
$$
\hat Y_{HT} = \sum_{i\in \bf{S}} \frac{Y_i}{\pi_i}
 = \sum_{i\in \bf{S}} \frac{Y_i}{1 - (1 - p_i)^m}
$$
with an upper bound on the variance of
$$
Var(\hat Y_{HT}) \leq \sum_{i,j=1}^N 
    \left(\frac{1}{(1 - (1 - p_i)^m)^{1/2}(1 - (1 - p_j)^m)^{1/2}} - 1\right) Y_i Y_j
$$
The variance does not tend to zero even as m tends to infinity. 
But, for the Horwitz Thompson average,
$$
Var(\hat \tau_{HT}) \leq \frac{1}{N^2}\sum_{i,j=1}^N 
    \left(\frac{1}{(1 - (1 - p_i)^m)^{1/2}(1 - (1 - p_j)^m)^{1/2}} - 1\right) Y_i Y_j
$$
If we make some simple assumptions
$$
p_i \sim a_i/N
$$
for nicely chosen $a_i$ and, for $0 < \alpha < 1$,
$$
m =  \alpha N
$$
then the variance tends to zero for large m.