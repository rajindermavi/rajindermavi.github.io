Let $\mathcal{K} =  \{1,2,...,N\} $ be a finite population. 
For each $i\in\mathcal{K}$, let $Y_i$ be an observable of unit $i$.
Our goal is to estimate
$$
Y = \sum_{i=1}^N Y_i
$$
the total of interest.


To construct the estimator we take a random sample from $\mathcal{K}$.
For $n < N$ let $\bf{S} = \{i_1,...,i_n\} \subset \mathcal{S}$ be a 
random sample. Let $\pi_i$ be the probability $i \in \bf{S} $ (assume $\pi_i > 0$).
The Horvitz Thompson esimator is 
$$
\hat Y = \sum_{i\in \bf{S}} \frac{Y_i}{\pi_i}
$$
The Horvitz Thompson estimate of the mean (AKA the Hansen-Hurwitz estimator) is simply given by
$$
\hat \mu = \frac1n \sum_{i\in \bf{S}} \frac{Y_i}{\pi_i}
$$
It's not hard to see that $\hat Y$ is an unbiased estimator of $Y$. 

To state the variance of $\hat Y$, 
define $p_{ij}$ as the probability that both $i$ and $j$ belong to $\bf{S}$. 
The variance of Horvitz Thompson is then
$$
Var(\hat Y) = \frac{1}{2}\sum_{i=1}^N\sum_{j=1;j\neq i}^{N} (\pi_ip_j - p_{ij})\left( \frac{Y_i}{\pi_i} - \frac{Y_j}{p_j} \right)^2 
$$
$$
Var(\hat mu) = \frac{1}{n^2}\frac{1}{2}\sum_{i=1}^N\sum_{j=1;j\neq i}^{N} (\pi_ip_j - p_{ij})\left( \frac{Y_i}{\pi_i} - \frac{Y_j}{p_j} \right)^2 
$$

It is not hard to see the variance has an upper bound,
$$
Var(\hat Y) \leq \sum_{i=1}^n \frac{Y_i^2}{\pi_i}
$$
but if some of the $\pi_i$ are small this raises the small denominator problem. 
So care would have to be taken in this case. 
This danger can be mollified through a modification of the HTE, the Hajek estimator.

On the other hand, the above gives an upper bound on the estimate of the mean 
$$
Var(\hat mu) \leq \frac{1}{N^2} \sum_{i=1}^n \frac{Y_i^2}{\pi_i}
$$

* Example ...
An example of the HTE is useful. 
Consider a collection of cities with populations greater than some lower bound $b$ in some state.
Let the cities be enumerated by $\mathcal{K} =  \{1,2,..,N\}$.
Let $Y_i$ be the total number of hotels in the ith city. 

Let $\pi_i$ be proportional to the population of the ith city. 
$$
\pi_i = \frac{q_i}{\sum_{i=1}^N q_i}
$$
where $q_i$ is the population of the ith city.
The estimate of the average number of hotels in large cities would be given by $\hat mu$ after sampling $n$ cities.
$$
\hat mu = \frac{1}{n}\sum_{i\in \bf{S}} \frac{Y_i}{\pi_i}
 = (\sum_{i=1}^N q_i) \left( \frac{1}{n} \sum_{i \in \bf{S}} \frac{Y_i}{q_i} \right)
$$
the summand can be seen to be the average number of hotels by population, 
so the average of averages gives an estimate of the hotel density. 
The prefactor of the total population scales the estimate up to the population.
Thus we have our estimate for the total hotels in large cities in our state.
